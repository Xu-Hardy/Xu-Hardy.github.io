name: Deploy GitHub Pages

# 触发条件：在 push 到 master 分支后
on:
  push:
    branches:
      - master

# 任务
jobs:
  build-and-deploy:
    # 服务器环境：最新版 Ubuntu
    runs-on: ubuntu-latest
    steps:
      # 拉取代码
      - name: Checkout
        uses: checkout@V2
        with:
          persist-credentials: false
          
      # 部署到 GitHub markdown BOOK
      - name: Deploy markdown Book
        uses: JamesIves/github-pages-deploy-action@releases/v4
        with:
          ACCESS_TOKEN: ${{ secrets.HEXO }}
          BRANCH: source-book
          FOLDER: source/_posts/

      # 生成静态文件
      - name: Build
        run: npm install && npm run build

      # 部署到 GitHub Pages
      - name: Deploy Pages
        uses: JamesIves/github-pages-deploy-action@releases/v4
        with:
          ACCESS_TOKEN: ${{ secrets.HEXO }}
          BRANCH: gh-pages
          FOLDER: public

# name: Pages

# on:
#   push:
#     branches:
#       - main # default branch

# jobs:
#   pages:
#     runs-on: ubuntu-latest
#     steps:
#       - uses: actions/checkout@v2
#       - name: Use Node.js 16.x
#         uses: actions/setup-node@v2
#         with:
#           node-version: "16"
#       - name: Cache NPM dependencies
#         uses: actions/cache@v2
#         with:
#           path: node_modules
#           key: ${{ runner.OS }}-npm-cache
#           restore-keys: |
#             ${{ runner.OS }}-npm-cache
#       - name: Install Dependencies
#         run: npm install
#       - name: Build
#         run: npm run build
#       - name: Deploy
#         uses: peaceiris/actions-gh-pages@v3
#         with:
#           github_token: ${{ secrets.HEXO }}
#           publish_dir: ./public